<!DOCTYPE html>
<html>
<head>
    <title>API Test - Greenhouse</title>
    <style>
        body { font-family: Arial; padding: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
        h1 { color: #10b981; }
        .test-item { padding: 10px; margin: 10px 0; border-left: 4px solid #10b981; background: #f0fdf4; }
        .error { border-left-color: #ef4444; background: #fef2f2; }
        button { padding: 10px 20px; background: #10b981; color: white; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #059669; }
        pre { background: #1f2937; color: #e5e7eb; padding: 15px; border-radius: 4px; overflow-x: auto; }
        .success { color: #10b981; font-weight: bold; }
        .fail { color: #ef4444; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸŒ¿ Greenhouse API Test</h1>
        
        <h2>Test Koneksi API</h2>
        
        <button onclick="testAPI('test_api.php')">Test API Files</button>
        <button onclick="testAPI('get_data.php')">Test Get Data</button>
        <button onclick="testAPI('get_thresholds.php')">Test Get Thresholds</button>
        <button onclick="testAPI('get_statistics.php?period=today')">Test Statistics</button>
        <button onclick="testAPI('../index.php', true)">Test Index Page</button>
        
        <div id="results"></div>
    </div>

    <script>
        async function testAPI(endpoint, isHTML = false) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<p>Testing: ' + endpoint + '...</p>';
            
            try {
                const url = endpoint.startsWith('..') ? endpoint : 'api/' + endpoint;
                const response = await fetch(url);
                
                const status = response.status;
                const statusText = response.statusText;
                
                let content = '';
                if (isHTML) {
                    content = await response.text();
                    content = content.substring(0, 500) + '...'; // First 500 chars
                } else {
                    content = await response.json();
                }
                
                const statusClass = status === 200 ? 'success' : 'fail';
                
                resultsDiv.innerHTML = `
                    <div class="test-item">
                        <h3>Endpoint: ${endpoint}</h3>
                        <p>Status: <span class="${statusClass}">${status} ${statusText}</span></p>
                        <p>Response:</p>
                        <pre>${isHTML ? content : JSON.stringify(content, null, 2)}</pre>
                    </div>
                `;
                
                if (status !== 200) {
                    resultsDiv.querySelector('.test-item').classList.add('error');
                }
                
            } catch (error) {
                resultsDiv.innerHTML = `
                    <div class="test-item error">
                        <h3>Error Testing: ${endpoint}</h3>
                        <p class="fail">Error: ${error.message}</p>
                        <p>Kemungkinan penyebab:</p>
                        <ul>
                            <li>File tidak ditemukan (404)</li>
                            <li>Permission denied</li>
                            <li>PHP syntax error</li>
                            <li>Database connection error</li>
                        </ul>
                    </div>
                `;
            }
        }
        
        // Auto test on load
        window.onload = () => {
            testAPI('test_api.php');
        };
    </script>
</body>
</html>
